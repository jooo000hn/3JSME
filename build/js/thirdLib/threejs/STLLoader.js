define(["THREE"],function(e){e.STLLoader=function(t){this.manager=t!==undefined?t:e.DefaultLoadingManager},e.STLLoader.prototype={constructor:e.STLLoader,load:function(t,n,r,i){var s=this,o=new e.XHRLoader(s.manager);o.setCrossOrigin(this.crossOrigin),o.setResponseType("arraybuffer"),o.load(t,function(e){n(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=function(){var e,t,r,i;i=new DataView(n),t=50,r=i.getUint32(80,!0),e=84+r*t;if(e===i.byteLength)return!0;var s=i.byteLength;for(var o=0;o<s;o++)if(i.getUint8(o,!1)>127)return!0;return!1},n=this.ensureBinary(e);return t()?this.parseBinary(n):this.parseASCII(this.ensureString(e))},parseBinary:function(t){var n=new DataView(t),r=n.getUint32(80,!0),i,s,o,u=!1,a,f,l,c,h;for(var p=0;p<70;p++)n.getUint32(p,false)==1129270351&&n.getUint8(p+4)==82&&n.getUint8(p+5)==61&&(u=!0,a=new Float32Array(r*3*3),f=n.getUint8(p+6)/255,l=n.getUint8(p+7)/255,c=n.getUint8(p+8)/255,h=n.getUint8(p+9)/255);var d=84,v=50,m=0,g=new e.BufferGeometry,y=new Float32Array(r*3*3),b=new Float32Array(r*3*3);for(var w=0;w<r;w++){var E=d+w*v,S=n.getFloat32(E,!0),x=n.getFloat32(E+4,!0),T=n.getFloat32(E+8,!0);if(u){var N=n.getUint16(E+48,!0);(N&32768)===0?(i=(N&31)/31,s=(N>>5&31)/31,o=(N>>10&31)/31):(i=f,s=l,o=c)}for(var C=1;C<=3;C++){var k=E+C*12;y[m]=n.getFloat32(k,!0),y[m+1]=n.getFloat32(k+4,!0),y[m+2]=n.getFloat32(k+8,!0),b[m]=S,b[m+1]=x,b[m+2]=T,u&&(a[m]=i,a[m+1]=s,a[m+2]=o),m+=3}}return g.addAttribute("position",new e.BufferAttribute(y,3)),g.addAttribute("normal",new e.BufferAttribute(b,3)),u&&(g.addAttribute("color",new e.BufferAttribute(a,3)),g.hasColors=!0,g.alpha=h),g.computeFaceNormals(),g.computeVertexNormals(),g},parseASCII:function(t){var n,r,i,s,o,u,a,f;n=new e.Geometry,s=/facet([\s\S]*?)endfacet/g;while((a=s.exec(t))!==null){f=a[0],o=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;while((a=o.exec(f))!==null)i=new e.Vector3(parseFloat(a[1]),parseFloat(a[3]),parseFloat(a[5]));u=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;while((a=u.exec(f))!==null)n.vertices.push(new e.Vector3(parseFloat(a[1]),parseFloat(a[3]),parseFloat(a[5])));r=n.vertices.length,n.faces.push(new e.Face3(r-3,r-2,r-1,i))}return n.computeBoundingBox(),n.computeBoundingSphere(),n.computeFaceNormals(),n.computeVertexNormals(),n},ensureString:function(e){if(typeof e!="string"){var t=new Uint8Array(e),n="";for(var r=0;r<e.byteLength;r++)n+=String.fromCharCode(t[r]);return n}return e},ensureBinary:function(e){if(typeof e=="string"){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer||t}return e}},typeof DataView=="undefined"&&(DataView=function(e,t,n){this.buffer=e,this.byteOffset=t||0,this.byteLength=n||e.byteLength||e.length,this._isString=typeof e=="string"},DataView.prototype={_getCharCodes:function(e,t,n){t=t||0,n=n||e.length;var r=t+n,i=[];for(var s=t;s<r;s++)i.push(e.charCodeAt(s)&255);return i},_getBytes:function(e,t,n){var r;n===undefined&&(n=this._littleEndian),t===undefined?t=this.byteOffset:t=this.byteOffset+t,e===undefined&&(e=this.byteLength-t);if(typeof t!="number")throw new TypeError("DataView byteOffset is not a number");if(e<0||t+e>this.byteLength)throw new Error("DataView length or (byteOffset+length) value is out of bounds");return this.isString?r=this._getCharCodes(this.buffer,t,t+e):r=this.buffer.slice(t,t+e),!n&&e>1&&(Array.isArray(r)===!1&&(r=Array.prototype.slice.call(r)),r.reverse()),r},getFloat64:function(e,t){var n=this._getBytes(8,e,t),r=1-2*(n[7]>>7),i=((n[7]<<1&255)<<3|n[6]>>4)-1023,s=(n[6]&15)*Math.pow(2,48)+n[5]*Math.pow(2,40)+n[4]*Math.pow(2,32)+n[3]*Math.pow(2,24)+n[2]*Math.pow(2,16)+n[1]*Math.pow(2,8)+n[0];return i===1024?s!==0?NaN:r*Infinity:i===-1023?r*s*Math.pow(2,-1074):r*(1+s*Math.pow(2,-52))*Math.pow(2,i)},getFloat32:function(e,t){var n=this._getBytes(4,e,t),r=1-2*(n[3]>>7),i=(n[3]<<1&255|n[2]>>7)-127,s=(n[2]&127)<<16|n[1]<<8|n[0];return i===128?s!==0?NaN:r*Infinity:i===-127?r*s*Math.pow(2,-149):r*(1+s*Math.pow(2,-23))*Math.pow(2,i)},getInt32:function(e,t){var n=this._getBytes(4,e,t);return n[3]<<24|n[2]<<16|n[1]<<8|n[0]},getUint32:function(e,t){return this.getInt32(e,t)>>>0},getInt16:function(e,t){return this.getUint16(e,t)<<16>>16},getUint16:function(e,t){var n=this._getBytes(2,e,t);return n[1]<<8|n[0]},getInt8:function(e){return this.getUint8(e)<<24>>24},getUint8:function(e){return this._getBytes(1,e)[0]}})});