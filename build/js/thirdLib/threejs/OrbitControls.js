define(["THREE"],function(e){function t(t){this.object=t,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.25;var n=this,r=1e-6,i,s,o=0,u=0,a=1,f=new e.Vector3,l=!1;this.getPolarAngle=function(){return s},this.getAzimuthalAngle=function(){return i},this.rotateLeft=function(e){u-=e},this.rotateUp=function(e){o-=e},this.panLeft=function(){var t=new e.Vector3;return function(n){var r=this.object.matrix.elements;t.set(r[0],r[1],r[2]),t.multiplyScalar(-n),f.add(t)}}(),this.panUp=function(){var t=new e.Vector3;return function(n){var r=this.object.matrix.elements;t.set(r[4],r[5],r[6]),t.multiplyScalar(n),f.add(t)}}(),this.pan=function(t,r,i,s){if(n.object instanceof e.PerspectiveCamera){var o=n.object.position,u=o.clone().sub(n.target),a=u.length();a*=Math.tan(n.object.fov/2*Math.PI/180),n.panLeft(2*t*a/s),n.panUp(2*r*a/s)}else n.object instanceof e.OrthographicCamera?(n.panLeft(t*(n.object.right-n.object.left)/i),n.panUp(r*(n.object.top-n.object.bottom)/s)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(t){n.object instanceof e.PerspectiveCamera?a/=t:n.object instanceof e.OrthographicCamera?(n.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*t)),n.object.updateProjectionMatrix(),l=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(t){n.object instanceof e.PerspectiveCamera?a*=t:n.object instanceof e.OrthographicCamera?(n.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/t)),n.object.updateProjectionMatrix(),l=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var n=new e.Vector3,c=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),h=c.clone().inverse(),p=new e.Vector3,d=new e.Quaternion;return function(){var e=this.object.position;n.copy(e).sub(this.target),n.applyQuaternion(c),i=Math.atan2(n.x,n.z),s=Math.atan2(Math.sqrt(n.x*n.x+n.z*n.z),n.y),i+=u,s+=o,i=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,i)),s=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s)),s=Math.max(r,Math.min(Math.PI-r,s));var t=n.length()*a;return t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(f),n.x=t*Math.sin(s)*Math.sin(i),n.y=t*Math.cos(s),n.z=t*Math.sin(s)*Math.cos(i),n.applyQuaternion(h),e.copy(this.target).add(n),this.object.lookAt(this.target),this.enableDamping===!0?(u*=1-this.dampingFactor,o*=1-this.dampingFactor):(u=0,o=0),a=1,f.set(0,0,0),l||p.distanceToSquared(this.object.position)>r||8*(1-d.dot(this.object.quaternion))>r?(p.copy(this.object.position),d.copy(this.object.quaternion),l=!1,!0):!1}}()}e.OrbitControls=function(n,r){function w(e,t){var n=s.domElement===document?s.domElement.body:s.domElement;i.pan(e,t,n.clientWidth,n.clientHeight)}function E(){return 2*Math.PI/60/60*s.autoRotateSpeed}function S(){return Math.pow(.95,s.zoomSpeed)}var i=new t(n);this.domElement=r!==undefined?r:document,Object.defineProperty(this,"constraint",{get:function(){return i}}),this.getPolarAngle=function(){return i.getPolarAngle()},this.getAzimuthalAngle=function(){return i.getAzimuthalAngle()},this.enabled=!0,this.center=this.target,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:e.MOUSE.LEFT,ZOOM:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT};var s=this,o=new e.Vector2,u=new e.Vector2,a=new e.Vector2,f=new e.Vector2,l=new e.Vector2,c=new e.Vector2,h=new e.Vector2,p=new e.Vector2,d=new e.Vector2,v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},m=v.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var g={type:"change"},y={type:"start"},b={type:"end"};this.update=function(){this.autoRotate&&m===v.NONE&&i.rotateLeft(E()),i.update()===!0&&this.dispatchEvent(g)},this.reset=function(){m=v.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(g),this.update()},this.onMouseDown=function(e){if(s.enabled===!1)return;e.preventDefault();if(e.button===s.mouseButtons.ORBIT){if(s.enableRotate===!1)return;m=v.ROTATE,o.set(e.clientX,e.clientY)}else if(e.button===s.mouseButtons.ZOOM){if(s.enableZoom===!1)return;m=v.DOLLY,h.set(e.clientX,e.clientY)}else if(e.button===s.mouseButtons.PAN){if(s.enablePan===!1)return;m=v.PAN,f.set(e.clientX,e.clientY)}m!==v.NONE&&s.dispatchEvent(y)},this.onMouseMove=function(e){if(s.enabled===!1)return;e.preventDefault();var t=s.domElement===document?s.domElement.body:s.domElement;if(m===v.ROTATE){if(s.enableRotate===!1)return;u.set(e.clientX,e.clientY),a.subVectors(u,o),i.rotateLeft(2*Math.PI*a.x/t.clientWidth*s.rotateSpeed),i.rotateUp(2*Math.PI*a.y/t.clientHeight*s.rotateSpeed),o.copy(u)}else if(m===v.DOLLY){if(s.enableZoom===!1)return;p.set(e.clientX,e.clientY),d.subVectors(p,h),d.y>0?i.dollyIn(S()):d.y<0&&i.dollyOut(S()),h.copy(p)}else if(m===v.PAN){if(s.enablePan===!1)return;l.set(e.clientX,e.clientY),c.subVectors(l,f),w(c.x,c.y),f.copy(l)}m!==v.NONE&&s.update()},this.onMouseUp=function(){if(s.enabled===!1)return;s.dispatchEvent(b),m=v.NONE},this.onMouseWheel=function(e){if(s.enabled===!1||s.enableZoom===!1||m!==v.NONE)return;e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta!==undefined?t=e.wheelDelta:e.detail!==undefined&&(t=-e.detail),t>0?i.dollyOut(S()):t<0&&i.dollyIn(S()),s.update(),s.dispatchEvent(y),s.dispatchEvent(b)},this.onKeyDown=function(e){if(s.enabled===!1||s.enableKeys===!1||s.enablePan===!1)return;switch(e.keyCode){case s.keys.UP:w(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:w(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:w(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:w(-s.keyPanSpeed,0),s.update()}},this.onTouchStart=function(e){if(s.enabled===!1)return;switch(e.touches.length){case 1:if(s.enableRotate===!1)return;m=v.TOUCH_ROTATE,o.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(s.enableZoom===!1)return;m=v.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);h.set(0,r);break;case 3:if(s.enablePan===!1)return;m=v.TOUCH_PAN,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:m=v.NONE}m!==v.NONE&&s.dispatchEvent(y)},this.onTouchMove=function(e){if(s.enabled===!1)return;e.preventDefault(),e.stopPropagation();var t=s.domElement===document?s.domElement.body:s.domElement;switch(e.touches.length){case 1:if(s.enableRotate===!1)return;if(m!==v.TOUCH_ROTATE)return;u.set(e.touches[0].pageX,e.touches[0].pageY),a.subVectors(u,o),i.rotateLeft(2*Math.PI*a.x/t.clientWidth*s.rotateSpeed),i.rotateUp(2*Math.PI*a.y/t.clientHeight*s.rotateSpeed),o.copy(u),s.update();break;case 2:if(s.enableZoom===!1)return;if(m!==v.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,g=Math.sqrt(n*n+r*r);p.set(0,g),d.subVectors(p,h),d.y>0?i.dollyOut(S()):d.y<0&&i.dollyIn(S()),h.copy(p),s.update();break;case 3:if(s.enablePan===!1)return;if(m!==v.TOUCH_PAN)return;l.set(e.touches[0].pageX,e.touches[0].pageY),c.subVectors(l,f),w(c.x,c.y),f.copy(l),s.update();break;default:m=v.NONE}},this.onTouchEnd=function(){if(s.enabled===!1)return;s.dispatchEvent(b),m=v.NONE},this.contextmenu=function(e){e.preventDefault()},this.dispose=function(){},this.update()},e.OrbitControls.prototype=Object.create(e.EventDispatcher.prototype),e.OrbitControls.prototype.constructor=e.OrbitControls,Object.defineProperties(e.OrbitControls.prototype,{object:{get:function(){return this.constraint.object}},target:{get:function(){return this.constraint.target},set:function(e){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead."),this.constraint.target.copy(e)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(e){this.constraint.minDistance=e}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(e){this.constraint.maxDistance=e}},minZoom:{get:function(){return this.constraint.minZoom},set:function(e){this.constraint.minZoom=e}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(e){this.constraint.maxZoom=e}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(e){this.constraint.minPolarAngle=e}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(e){this.constraint.maxPolarAngle=e}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(e){this.constraint.minAzimuthAngle=e}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},set:function(e){this.constraint.maxAzimuthAngle=e}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(e){this.constraint.enableDamping=e}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(e){this.constraint.dampingFactor=e}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}})});