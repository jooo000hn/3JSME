define(["require","lib/CommonUtil","THREE","module/util/ModelFrameSet","module/GlobalVar","thirdLib/threejs/TransformControls"],function(e){"use strict";function s(e){this._attachedModel=null,this._transformMode=this.TRANSFORM_MODE.TRANSFORM,this._transformControls=null,this._init(e)}var t=e("lib/CommonUtil"),n=e("THREE"),r=e("module/util/ModelFrameSet"),i=e("module/GlobalVar");return e("thirdLib/threejs/TransformControls"),s.prototype.TRANSFORM_MODE={TRANSFORM:0,ROTATE:1,SCALE:2},s.prototype._init=function(e){this._transformControls=new n.TransformControls(i.sceneController.getRenderTarget().camera,e),this._transformControls.setSpace("world"),this._transformControls.size=2,i.sceneController.spawnMesh(this._transformControls)},s.prototype.mirrorX=function(){if(!t.isDefined(this._attachedModel))return;this._attachedModel.mirrorX()},s.prototype.mirrorY=function(){if(!t.isDefined(this._attachedModel))return;this._attachedModel.mirrorY()},s.prototype.mirrorZ=function(){if(!t.isDefined(this._attachedModel))return;this._attachedModel.mirrorZ()},s.prototype.resetModel=function(){if(!t.isDefined(this._attachedModel))return;this._attachedModel.reset()},s.prototype.deleteModel=function(){if(!t.isDefined(this._attachedModel))return;i.sceneController.disposeModel(this._attachedModel),this._attachedModel=null,this._transformControls.detach()},s.prototype.copyModel=function(){if(!t.isDefined(this._attachedModel))return;i.sceneController.spawnModel(this._attachedModel.clone())},s.prototype.setModelScaleValue=function(e,t,n,r){var i=this.getModelScaleValue();r&&(null!==e?(t=i.y*(e/i.x),n=i.z*(e/i.x)):null!==t?(e=i.x*(t/i.y),n=i.z*(t/i.y)):(e=i.x*(n/i.z),t=i.y*(n/i.z))),this._attachedModel.setScale(e,t,n),this._attachedModel.update()},s.prototype.getModelScaleValue=function(){return this._attachedModel.getScale()},s.prototype.setModelLWH=function(e,n,r,i){if(!t.isDefined(this._attachedModel))return;var s=this.getModelLWH(),o=this.getModelScaleValue(),u=o.x/s.x,a=o.y/s.y,f=o.z/s.z;i&&(null!==e?(r=s.y*(e/s.x),n=s.z*(e/s.x)):null!==r?(e=s.x*(r/s.y),n=s.z*(r/s.y)):(r=s.y*(n/s.z),e=s.x*(n/s.z))),this.setModelScaleValue(e*u,r*a,n*f)},s.prototype.getModelLWH=function(){return this._attachedModel.getSize()},s.prototype.setMode=function(e){this._transformMode=e;switch(e){case this.TRANSFORM_MODE.TRANSFORM:this._transformControls.setMode("translate"),this._transformControls.setSpace("world");break;case this.TRANSFORM_MODE.ROTATE:this._transformControls.setMode("rotate"),this._transformControls.setSpace("world");break;case this.TRANSFORM_MODE.SCALE:this._transformControls.setMode("scale"),this._transformControls.setSpace("local");break;default:}this._transformControls.visible=!0},s.prototype.attachModel=function(e){t.isDefined(this._attachedModel)&&this._attachedModel.unselected(),this._transformControls.attach(e.get().model),this._attachedModel=e,this._attachedModel.selected(),this.setMode(this._transformMode)},s.prototype.onPointerDown=function(e,t){return this._transformControls.onPointerDown(e)},s.prototype.onPointerMove=function(e){if(!t.isDefined(this._attachedModel))return;this._transformControls.onPointerMove(e);if(this.TRANSFORM_MODE.ROTATE===this._transformMode)return;this._attachedModel.update()},s.prototype.onPointerHover=function(e){if(!t.isDefined(this._attachedModel))return;this._transformControls.onPointerHover(e)},s.prototype.onPointerUp=function(e){if(!t.isDefined(this._attachedModel))return;this._transformControls.onPointerUp(e),this._attachedModel.update()},s.prototype.update=function(){this._transformControls.update()},s});