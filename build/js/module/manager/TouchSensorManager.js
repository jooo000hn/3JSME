define(["require","THREE","module/component/TransformTool","module/util/ModelFrameSet","module/GlobalVar","thirdLib/threejs/OrbitControls"],function(e){"use strict";function o(){this._status=this.STATUS_TRANSFROM.TRANSLATE,this._transformTool=null,this._orbitControl=null,this._isTouchSensorDown=!1,this._isMouseMove=!1,this._isTransformStatus=!1,this._init()}var t=e("THREE"),n=e("module/component/TransformTool"),r=e("module/util/ModelFrameSet"),i=e("module/GlobalVar");e("thirdLib/threejs/OrbitControls");var s=null;return o.prototype.STATUS_TRANSFROM={TRANSLATE:0,ROTATE:1,SCALE:2},o.prototype.STATUS_PRINT_CUSTOM={ADD_SUPPORT:3},o.prototype._init=function(){this._initTransformControl(),this._initOrbitControl()},o.prototype._initTransformControl=function(){this._transformTool=new n(i.sceneController.getRenderTarget().domElement),i.transformTool=this._transformTool},o.prototype._initOrbitControl=function(){this._orbitControl=new t.OrbitControls(i.sceneController.getRenderTarget().camera,i.sceneController.getRenderTarget().domElement),this._orbitControl.enableDamping=!0,this._orbitControl.enablePan=!1},o.prototype.setStatus=function(e){this._status=e;switch(e){case this.STATUS_TRANSFROM.TRANSLATE:this._transformTool.setMode(n.prototype.TRANSFORM_MODE.TRANSFORM);break;case this.STATUS_TRANSFROM.ROTATE:this._transformTool.setMode(n.prototype.TRANSFORM_MODE.ROTATE);break;case this.STATUS_TRANSFROM.SCALE:this._transformTool.setMode(n.prototype.TRANSFORM_MODE.SCALE);break;default:}},o.prototype.isPrintCustomMode=function(){return this._status>this.STATUS_TRANSFROM.SCALE},o.prototype.getStatus=function(){return this._status},o.prototype.onOperatingStart=function(e,t){this._isTouchSensorDown=!0,this._isTransformStatus=this._isSwitchToTransformStatus(e),this._isTransformStatus||this._onOrbitControlOperating(e,t)},o.prototype.onOperatingMove=function(e,t){this._transformTool.onPointerHover(e);if(!this._isTouchSensorDown)return;this._isMouseMove=!0,this._isTransformStatus?this._transformTool.onPointerMove(e):this._onOrbitControlOperating(e,t)},o.prototype.onOperatingEnd=function(e,t){this._isTransformStatus&&!this._isMouseMove&&null!==s&&(this._orbitControl.target=s),this._isMouseMove=!1,this._isTouchSensorDown=!1,this._transformTool.onPointerUp(e),this._onOrbitControlOperating(e,t)},o.prototype.onZoomOperating=function(e){this._orbitControl.onMouseWheel(e)},o.prototype._isSwitchToTransformStatus=function(e){var t=i.sceneController.queryModelFrame(e);return 0<t.length&&(this._transformTool.attachModel(r.getModelFrame(t[0].object)),s=t[0].object.position),this._transformTool.onPointerDown(e,0<t.length?t[0].point:null)},o.prototype._onOrbitControlOperating=function(e,t){switch(t){case"onMouseMove":this._orbitControl.onMouseMove(e);break;case"onTouchMove":this._orbitControl.onTouchMove(e);break;case"onTouchStart":this._orbitControl.onTouchStart(e);break;case"onMouseDown":this._orbitControl.onMouseDown(e);break;case"onMouseUp":this._orbitControl.onMouseUp(e);break;case"onTouchEnd":this._orbitControl.onTouchEnd(e);break;default:}},o.prototype.update=function(){this._transformTool.update(),this._orbitControl.update()},o});